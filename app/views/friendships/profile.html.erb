<section class="section">
  <div class="container">
    <div class="columns">
      <div style="display:flex; flex-direction:column">
        <div class="column is-one-quarter" style="width:inherit">
            <nav class="panel">
                <p class="panel-heading">Profile</p>
                <div class="panel-block">
                    <article class="media">
                        <div class="media-left">
                            <figure class="image is-64x64">
                                <%= link_to image_tag(@user.avatar_thumbnail), profile_path(user_id: @user.id) %>
                            </figure>
                        </div>
                        
                        <div class="media-content">
                            <div class="content">
                                <p>
                                    <strong><%= link_to @user.name, profile_path(user_id: @user.id) %></strong><br />
                                    <small><%= link_to '@'+@user.username, profile_path(user_id: @user.id)  %></small><br>
                                    <%=  @user.bio %><br />
							        <small><i>Joined <%= time_ago_in_words @user.created_at %> ago</i></small>
                                </p>
                            </div>
                        </div>
                        <div></div>
                        <div>
                            <div class="media-right">
                                <% if user_signed_in? && current_user != @user %>
                                    <% if !current_user.following?(@user) %>
                                        <%= button_to "Follow", friendships_path(user_id: @user.id) %>
                                    <% else %>
                                        <%= button_to "Unfollow", friendships_path(user_id: @user.id), method: :delete %>
                                    <% end %>
                                <% end %>
                            </div>
                        </div>
                    </article>
                </div>
                <div class="panel-block">
                    <div class="level is-mobile">
                        <div class="level-item has-centered-text">
                            <div>
                                <p class="heading">Tweets</p>
                                <p class="title is-6"><%= link_to @user.tweets.count, profile_path(user_id: @user.id) %></p>
                            </div>
                        </div>
                        <div class="level-item has-centered-text">
                            <div>
                                <p class="heading">Following</p>
                                <p class="title is-6"><%= link_to @user.following.count, followings_list_path(user_id: @user.id) %></p>
                            </div>
                        </div>
                            <div class="level-item has-centered-text">
                            <div>
                                <p class="heading">Followers</p>
                                <p class="title is-6"><%= link_to @user.followers.count, followers_list_path(user_id: @user.id) %></p>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <%= render 'trends' %>
      </div>
       
    <div class="column is-half">
        <h1><%=  @user.name%><span>'s Tweets</span></h1>
        <% @tweets.order("created_at DESC").each do | tweet | %>
        <% @tweet = tweet %>
        <div class="box">
            <article class="media">
                <div class="media-left">
                    <figure class="image is-64x64">
                        <%= link_to image_tag(@tweet.user.avatar_thumbnail), profile_path(user_id: @tweet.user.id) %>
                    </figure>
                </div>
                <div class="media-content">
                    <div class="content">
                        <% if @tweet.parent_id != nil %>
                            <small><i><%= "Replied to "  %></i></small>
                            <%= link_to "tweet", tweet_path(@tweet.parent_id) %>
                            <br>
                        <% end %>
                        <strong><%= @tweet.user.name %> </strong>
                        <small><%= '@'+@tweet.user.username %> . </small> 
                        <small><%= time_ago_in_words @tweet.created_at %> ago</small><br />
                        <p><%= render 'hash_and_at' %></p>
                        
                        <div style="display:flex; width:200px; justify-content:space-evenly; align-items: center;">
                            <% if @tweet.parent_id == nil %>
                                <%= link_to Tweet.where(parent_id: @tweet.id).count, tweet_path(@tweet) %>
                            <% else %>
                                <%= Tweet.where(parent_id: tweet.id).count %>
                            <% end %>
						    <%= "Replies"%>
                            <% if user_signed_in? %>
                                <% like = current_user.likes.find_by(tweet: tweet) %>
                                <% if like.nil? %>
                                    <%= button_to  likes_path, params: {like: {tweet_id: tweet.id }}, method: :post do %>
                                        <span class="icon"><i class="fa fa-heart-o" aria-hidden="true"></i></span>
                                    <% end %>
                                <% else %>
                                    <%= button_to  like_path(like), method: :delete do %>
                                        <span class="icon"><i class="fa fa-heart" aria-hidden="true"></i></span>
                                    <% end %>
                                <% end %>
                            <% end %>
                            <%= link_to "#{tweet.likes.count} Likes",  "/tweets/likes/#{tweet.id}" %>
                        </div>
                    </div>

                <% if user_signed_in? && current_user.id == tweet.user_id %>
                    <nav class="level">
                        <div class="level-left is-mobile">
                            
                            <%= link_to tweet, class: "level-item" do %>
                            <span class="icon"><i class="fa fa-link" aria-hidden="true"></i></span>
                            <% end %>
                            <%= link_to edit_tweet_path(tweet), class: "level-item" do %>
                            <span class="icon"><i class="fa fa-pencil" aria-hidden="true"></i></span>
                            <% end %>
                            <%= button_to tweet, method: :delete, data: { confirm: "Are you sure you want to delete this tweet?" } do %>
                                <span class="icon"><i class="fa fa-trash-o" aria-hidden="true"></i></span>
                            <% end %>
                        </div>
                    </nav>
                <% end %>
                </div>
            </article>
        </div>
        <% end %>
        </div>
    </div>
  </div>
</section
